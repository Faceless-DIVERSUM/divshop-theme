{%- doc -%}
  Renders a hero carousel layer with images and configurable effects.
  
  @param {string} carousel_id - Unique identifier for this carousel
  @param {number} frame_duration - Duration for each frame in seconds
  @param {string} transition_type - Type of transition between frames
  @param {number} effect_zoom_intensity - Mouse over zoom effect intensity (1-10)
  @param {number} effect_parallax_vertical_intensity - Vertical parallax effect intensity (1-10)
  @param {number} effect_parallax_horizontal_intensity - Horizontal parallax effect intensity (1-10)
{%- enddoc -%}

{% liquid
  assign carousel_id = block.id | default: 'carousel-' | append: forloop.index0
  assign frame_duration = block.settings.frame_duration | default: 3
  assign transition_type = block.settings.transition_type | default: 'fade'
  assign zoom_intensity = block.settings.effect_zoom_intensity | default: 0
  assign parallax_v_intensity = block.settings.effect_parallax_vertical_intensity | default: 0
  assign parallax_h_intensity = block.settings.effect_parallax_horizontal_intensity | default: 0
  assign ken_burns_intensity = block.settings.effect_ken_burns_intensity | default: 0
  assign tilt_intensity = block.settings.effect_tilt_intensity | default: 0
  assign blur_focus_intensity = block.settings.effect_blur_focus_intensity | default: 0
  
  # Calculate effect values based on intensity
  assign zoom_scale = zoom_intensity | times: 0.01 | plus: 1.0
  assign parallax_v_strength = parallax_v_intensity | times: 5
  assign parallax_h_strength = parallax_h_intensity | times: 5
  assign ken_burns_scale = ken_burns_intensity | times: 0.02 | plus: 1.0
  assign tilt_angle = tilt_intensity | times: 2
  assign blur_amount = blur_focus_intensity | times: 2
%}

<div 
  class="hero-carousel-layer"
  data-carousel-id="{{ carousel_id }}"
  data-frame-duration="{{ frame_duration }}"
  data-transition-type="{{ transition_type }}"
  data-zoom-intensity="{{ zoom_intensity }}"
  data-parallax-v-intensity="{{ parallax_v_intensity }}"
  data-parallax-h-intensity="{{ parallax_h_intensity }}"
  data-ken-burns-intensity="{{ ken_burns_intensity }}"
  data-tilt-intensity="{{ tilt_intensity }}"
  data-blur-focus-intensity="{{ blur_focus_intensity }}"
  style="
    --carousel-zoom-scale: {{ zoom_scale }};
    --carousel-parallax-v: {{ parallax_v_strength }}px;
    --carousel-parallax-h: {{ parallax_h_strength }}px;
    --carousel-frame-duration: {{ frame_duration }}s;
    --carousel-ken-burns-scale: {{ ken_burns_scale }};
    --carousel-tilt-angle: {{ tilt_angle }}deg;
    --carousel-blur-amount: {{ blur_amount }}px;
  "
>
  {% if block.settings.image_1 != blank or block.settings.image_2 != blank or block.settings.image_3 != blank or block.settings.image_4 != blank or block.settings.image_5 != blank %}
    <div class="hero-carousel-frames">
      {% assign frame_count = 0 %}
      {% for i in (1..5) %}
        {% assign image_key = 'image_' | append: i %}
        {% assign image = block.settings[image_key] %}
        {% if image != blank %}
          {% assign frame_count = frame_count | plus: 1 %}
          <div 
            class="hero-carousel-frame {% if frame_count == 1 %}active{% endif %}"
            data-frame-index="{{ frame_count | minus: 1 }}"
          >
            {{ image | image_url: width: 3840 | image_tag: 
              class: 'hero-carousel-image',
              loading: 'lazy',
              sizes: '100vw',
              widths: '832, 1200, 1600, 1920, 2560, 3840'
            }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "Hero Carousel Layer",
  "settings": [
    {
      "type": "header",
      "content": "Images"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Frame 1 Image"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Frame 2 Image"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Frame 3 Image"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Frame 4 Image"
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Frame 5 Image"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "frame_duration",
      "label": "Frame Duration",
      "min": 0.5,
      "max": 10,
      "step": 0.1,
      "unit": "s",
      "default": 3,
      "info": "How long each frame is displayed"
    },
    {
      "type": "select",
      "id": "transition_type",
      "label": "Transition Type",
      "options": [
        {
          "value": "fade",
          "label": "Fade"
        },
        {
          "value": "slide",
          "label": "Slide"
        },
        {
          "value": "zoom",
          "label": "Zoom"
        },
        {
          "value": "blur",
          "label": "Blur"
        }
      ],
      "default": "fade"
    },
    {
      "type": "header",
      "content": "Effects"
    },
    {
      "type": "range",
      "id": "effect_zoom_intensity",
      "label": "Mouse Over Zoom",
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "Zoom effect on mouse hover (0 = disabled, 10 = maximum)"
    },
    {
      "type": "range",
      "id": "effect_parallax_vertical_intensity",
      "label": "Vertical Parallax",
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "Vertical parallax scroll effect (0 = disabled, 10 = maximum)"
    },
    {
      "type": "range",
      "id": "effect_parallax_horizontal_intensity",
      "label": "Horizontal Parallax", 
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "Horizontal parallax scroll effect (0 = disabled, 10 = maximum)"
    },
    {
      "type": "range",
      "id": "effect_ken_burns_intensity",
      "label": "Ken Burns Effect",
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "Slow zoom and pan effect during transitions (0 = disabled, 10 = maximum)"
    },
    {
      "type": "range",
      "id": "effect_tilt_intensity",
      "label": "Tilt on Hover",
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "3D tilt effect on mouse hover (0 = disabled, 10 = maximum)"
    },
    {
      "type": "range",
      "id": "effect_blur_focus_intensity",
      "label": "Blur to Focus",
      "min": 0,
      "max": 10,
      "step": 0.01,
      "unit": "",
      "default": 0,
      "info": "Blur effect that focuses on hover (0 = disabled, 10 = maximum)"
    }
  ]
}
{% endschema %}